# Mini Query Builder v2.0 - Usage Guide

## What's New in v2.0

This version includes major refactoring following SOLID principles and introduces many new features:

### üöÄ New Features

#### 1. Class-Based Query Builders

Now you can use class-based query builders for more fluent API:

```typescript
import { queryBuilderFactory } from "mini-query-builder";

// SELECT with fluent API
const result = queryBuilderFactory
  .createSelect(User)
  .where({ status: "active" })
  .orderBy("name", "ASC")
  .limit(10)
  .build();

// UPDATE with fluent API
const updateResult = queryBuilderFactory
  .createUpdate(User)
  .set({ status: "inactive" })
  .where({ id: { $gt: 100 } })
  .build();
```

#### 2. Common Transformers

Pre-built transformers for common data types:

```typescript
import { CommonTransformers } from 'mini-query-builder';

@Column({
  name: 'settings',
  transformer: CommonTransformers.JSON // For objects and arrays
})
settings: UserSettings;

@Column({
  name: 'tags',
  transformer: CommonTransformers.STRING_ARRAY // For string arrays
})
tags: string[];

@Column({
  name: 'scores',
  transformer: CommonTransformers.NUMBER_ARRAY // For number arrays
})
scores: number[];
```

#### 3. Enhanced Type Safety

Improved TypeScript support with better intellisense:

```typescript
// Strong typing for WHERE clauses
const query = selectQuery(User, {
  where: {
    age: { $gte: 18 }, // ‚úÖ Valid
    name: { $like: "%john%" }, // ‚úÖ Valid
    // email: { $like: 123 }   // ‚ùå TypeScript error
  },
});
```

#### 4. Better Error Handling

Comprehensive error types:

```typescript
import {
  MetadataNotFoundError,
  InvalidRelationError,
} from "mini-query-builder";

try {
  const query = selectQuery(UnknownEntity);
} catch (error) {
  if (error instanceof MetadataNotFoundError) {
    console.log("Entity not properly decorated");
  }
}
```

#### 5. Enhanced BaseEntity

More utility methods:

```typescript
const user = new User();
user.name = "John";

// Convert to plain object
const plain = user.toPlain();

// Clone entity
const clone = user.clone();

// Validate before save
user.validate();
```

### üèóÔ∏è Architecture Improvements

#### SOLID Principles Applied

- **Single Responsibility**: Each class has one clear purpose
- **Open/Closed**: Extensible without modifying existing code
- **Liskov Substitution**: Interfaces can be safely substituted
- **Interface Segregation**: Small, focused interfaces
- **Dependency Inversion**: Depends on abstractions, not concretions

#### New Query Operators

Enhanced WHERE clause operators:

```typescript
const queries = selectQuery(User, {
  where: {
    age: { $gte: 18 }, // Greater than or equal
    status: { $in: ["active", "pending"] }, // IN clause
    email: { $null: false }, // NOT NULL
    name: { $not: "admin" }, // NOT EQUAL
  },
});
```

### üìö Migration Guide

#### For Existing Users

All existing code continues to work without changes:

```typescript
// This still works exactly the same
const query = selectQuery(User, {
  where: { id: 1 },
  relations: ["posts"],
});
```

#### Recommended Updates

For new code, prefer the class-based approach:

```typescript
// Old way (still supported)
const oldQuery = selectQuery(User, { where: { id: 1 } });

// New way (recommended)
const newQuery = queryBuilderFactory
  .createSelect(User)
  .where({ id: 1 })
  .build();
```

### üîß Advanced Usage

#### Custom Transformers

Create your own transformers:

```typescript
const customTransformer: IValueTransformer<MyType, string> = {
  to: (value: MyType) => value.serialize(),
  from: (value: string) => MyType.deserialize(value),
};
```

#### Custom Operators

Extend WHERE clause operators:

```typescript
import { OperatorRegistry } from "mini-query-builder";

OperatorRegistry.register("$custom", {
  handle: (columnName, operand, transformer) => ({
    condition: `${columnName} CUSTOM ?`,
    params: [transformer(operand)],
  }),
});
```

### üêõ Bug Fixes

- Fixed circular dependency issues
- Improved memory usage
- Better error messages
- Enhanced type inference

### üöÄ Performance Improvements

- Faster query building
- Reduced bundle size
- Better tree shaking support
- Optimized metadata storage

## Backwards Compatibility

All existing APIs remain fully functional. This is a **non-breaking** update that adds new features while maintaining compatibility with v1.0 code.
